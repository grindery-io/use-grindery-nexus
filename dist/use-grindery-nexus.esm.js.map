{"version":3,"file":"use-grindery-nexus.esm.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useState, useEffect, createContext, useContext } from 'react';\n// @ts-ignore\nimport Web3Modal from 'web3modal';\n// @ts-ignore\nimport { providers } from 'ethers';\n\nexport type GrinderyNexusContextProps = {\n  /** Connect user wallet */\n  connect: () => void;\n\n  /** Disconnect user wallet */\n  disconnect: () => void;\n\n  /** User ID. Reference: https://github.com/ChainAgnostic/CAIPs/blob/master/CAIPs/caip-10.md */\n  user: string | null;\n\n  /** Set User ID  */\n  setUser: React.Dispatch<React.SetStateAction<string | null>>;\n\n  /** User wallet address  */\n  address: string | null;\n\n  /** Set user wallet address  */\n  setAddress: React.Dispatch<React.SetStateAction<string | null>>;\n\n  /** User chain id  */\n  chain: number | null;\n\n  /** Set user chain id  */\n  setChain: React.Dispatch<React.SetStateAction<number | null>>;\n};\n\nexport type GrinderyNexusContextProviderProps = {\n  children: React.ReactNode;\n\n  /** Automatically authenticate user */\n  cacheProvider?: boolean;\n};\n\n/** Grindery Nexus Context */\nexport const GrinderyNexusContext = createContext<GrinderyNexusContextProps>({\n  connect: () => {},\n  disconnect: () => {},\n  user: null,\n  setUser: () => {},\n  address: null,\n  setAddress: () => {},\n  chain: null,\n  setChain: () => {},\n});\n\n/** Grindery Nexus Context Provider */\nexport const GrinderyNexusContextProvider = (\n  props: GrinderyNexusContextProviderProps\n) => {\n  const children = props.children;\n  const cacheProvider =\n    typeof props.cacheProvider !== 'undefined' ? props.cacheProvider : true;\n\n  // Web3Modal instance\n  const [web3Modal, setWeb3Modal] = useState<any>(null);\n\n  // User id\n  const [user, setUser] = useState<string | null>(null);\n\n  // User wallet address\n  const [address, setAddress] = useState<string | null>(null);\n\n  // User chain id\n  const [chain, setChain] = useState<number | null>(null);\n\n  const addListeners = async (web3ModalProvider: any) => {\n    // Subscribe to account change\n    web3ModalProvider.on('accountsChanged', () => {\n      window.location.reload();\n    });\n  };\n\n  const connect = async () => {\n    const provider = await web3Modal.connect();\n    addListeners(provider);\n    const ethersProvider = new providers.Web3Provider(provider);\n    const userAddress = await ethersProvider.getSigner().getAddress();\n    const userChain = await ethersProvider.getSigner().getChainId();\n    setAddress(userAddress);\n    setChain(userChain);\n  };\n\n  const disconnect = async () => {\n    await web3Modal.clearCachedProvider();\n    setUser(null);\n    setAddress(null);\n    setChain(null);\n  };\n\n  useEffect(() => {\n    const providerOptions = {};\n\n    const newWeb3Modal = new Web3Modal({\n      cacheProvider: cacheProvider,\n      network: 'mainnet',\n      providerOptions,\n    });\n\n    setWeb3Modal(newWeb3Modal);\n  }, []);\n\n  useEffect(() => {\n    // connect automatically and without a popup if user is already connected\n    if (web3Modal && web3Modal.cachedProvider) {\n      connect();\n    }\n  }, [web3Modal]);\n\n  useEffect(() => {\n    if (address) {\n      setUser(`eip155:1:${address}`);\n    } else {\n      setUser(null);\n    }\n  }, [address]);\n\n  return (\n    <GrinderyNexusContext.Provider\n      value={{\n        connect,\n        disconnect,\n        user,\n        setUser,\n        address,\n        setAddress,\n        chain,\n        setChain,\n      }}\n    >\n      {children}\n    </GrinderyNexusContext.Provider>\n  );\n};\n\n/** Grindery Nexus Hook */\nexport const useGrinderyNexus = () => useContext(GrinderyNexusContext);\n\nexport default GrinderyNexusContextProvider;\n"],"names":["GrinderyNexusContext","createContext","connect","disconnect","user","setUser","address","setAddress","chain","setChain","GrinderyNexusContextProvider","props","children","cacheProvider","useState","web3Modal","setWeb3Modal","addListeners","web3ModalProvider","on","window","location","reload","provider","ethersProvider","providers","Web3Provider","getSigner","getAddress","userAddress","getChainId","userChain","clearCachedProvider","useEffect","providerOptions","newWeb3Modal","Web3Modal","network","cachedProvider","React","Provider","value","useGrinderyNexus","useContext"],"mappings":"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"}