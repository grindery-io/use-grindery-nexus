{"version":3,"file":"use-grindery-nexus.cjs.production.min.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useState, useEffect, createContext, useContext } from 'react';\n// @ts-ignore\nimport Web3Modal from 'web3modal';\n// @ts-ignore\nimport * as ethersLib from 'ethers';\n// @ts-ignore\nimport { encode } from 'universal-base64url';\n// @ts-ignore\nimport * as fcl from '@onflow/fcl';\n\nexport const ENGINE_URL = 'https://orchestrator.grindery.org';\n\ndeclare global {\n  interface Window {\n    nexus_auth: any;\n  }\n}\n\n// Flow authentication account proof data type\ntype AccountProofData = {\n  // e.g. \"Awesome App (v0.0)\" - A human readable string to identify your application during signing\n  appIdentifier: string;\n\n  // e.g. \"75f8587e5bd5f9dcc9909d0dae1f0ac5814458b2ae129620502cb936fde7120a\" - minimum 32-byte random nonce as hex string\n  nonce: string;\n};\n\n// Flow auth account proof data resolver type\ntype AccountProofDataResolver = () => Promise<AccountProofData | null>;\n\n// Flow auth config\nfcl.config({\n  'flow.network': 'mainnet',\n  'discovery.wallet': 'https://fcl-discovery.onflow.org/authn',\n  'app.detail.title': 'Grindery Nexus',\n  'app.detail.icon':\n    'https://nexus.grindery.org/static/media/nexus-square.7402bdeb27ab56504250ca409fac38bd.svg',\n});\n\n// Authentication token object definition\nexport type AuthToken = {\n  access_token: string;\n  expires_in: number;\n  refresh_token: string;\n  token_type: string;\n};\n\n// Flow user type\ntype FlowUser = {\n  addr: string;\n  services?: any[];\n};\n\n// Context properties definition\nexport type GrinderyNexusContextProps = {\n  /** User ID. Reference: https://github.com/ChainAgnostic/CAIPs/blob/master/CAIPs/caip-10.md */\n  user: string | null;\n\n  /** Authentication token object */\n  token: AuthToken | null;\n\n  /** User wallet address  */\n  address: string | null;\n\n  /** User chain id  */\n  chain: number | string | null;\n\n  /** Authorization code */\n  code: string | null;\n\n  /** Flow user object */\n  flowUser: FlowUser;\n\n  /** Ethers provider */\n  provider: any;\n\n  /** Ethers */\n  ethers: any;\n\n  /** Blockchains name */\n  chainName: string | null | number;\n\n  /** Connect user wallet */\n  connect: () => void;\n\n  /** Disconnect user wallet */\n  disconnect: () => void;\n\n  /** Set User ID  */\n  setUser: React.Dispatch<React.SetStateAction<string | null>>;\n\n  /** Set user wallet address  */\n  setAddress: React.Dispatch<React.SetStateAction<string | null>>;\n\n  /** Set user chain id  */\n  setChain: React.Dispatch<React.SetStateAction<number | string | null>>;\n\n  /** Connect flow user */\n  connectFlow: () => void;\n};\n\nexport type GrinderyNexusContextProviderProps = {\n  children: React.ReactNode;\n\n  /** Automatically authenticate user */\n  cacheProvider?: boolean;\n};\n\n// Default context properties\nconst defaultContext = {\n  user: null,\n  address: null,\n  chain: null,\n  token: null,\n  code: null,\n  flowUser: { addr: '' },\n  provider: null,\n  ethers: null,\n  chainName: null,\n  connect: () => {},\n  disconnect: () => {},\n  setUser: () => {},\n  setAddress: () => {},\n  setChain: () => {},\n  connectFlow: () => {},\n};\n\n/** Grindery Nexus Context */\nexport const GrinderyNexusContext = createContext<GrinderyNexusContextProps>(\n  defaultContext\n);\n\n/** Grindery Nexus Context Provider */\nexport const GrinderyNexusContextProvider = (\n  props: GrinderyNexusContextProviderProps\n) => {\n  const children = props.children;\n  const cacheProvider =\n    typeof props.cacheProvider !== 'undefined' ? props.cacheProvider : true;\n\n  // Web3Modal instance\n  const [web3Modal, setWeb3Modal] = useState<any>(null);\n\n  // Web3Provider library\n  const [library, setLibrary] = useState<any>(null);\n\n  // User account\n  const [account, setAccount] = useState<string | null>(null);\n\n  // User id\n  const [user, setUser] = useState<string | null>(null);\n\n  // User wallet address\n  const [address, setAddress] = useState<string | null>(null);\n\n  // User chain id\n  const [chain, setChain] = useState<number | string | null>(null);\n\n  // Auth message\n  const [message, setMessage] = useState<string | null>(null);\n\n  // Authentication token object\n  const [token, setToken] = useState<AuthToken | null>(null);\n\n  // Signed authentication message\n  const [signature, setSignature] = useState<string | null>(null);\n\n  // Flow chain user\n  const [flowUser, setFlowUser] = useState<FlowUser>({ addr: '' });\n\n  // Is Flow account resolver called\n  const [resolverCalled, setResolverCalled] = useState(false);\n\n  // Chains list\n  const [chains, setChains] = useState<any[]>([]);\n\n  const chainName =\n    chains.find(c => c.value && c.value === chain)?.label || chain;\n\n  const provider = library;\n\n  const ethers = ethersLib;\n\n  const flowProof =\n    flowUser &&\n    flowUser.addr &&\n    flowUser.services?.find(service => service.type === 'account-proof');\n\n  // Compiled authorization code\n  const code =\n    (message &&\n      signature &&\n      encode(\n        JSON.stringify({\n          message: message,\n          signature: signature,\n        })\n      )) ||\n    (flowProof &&\n      flowProof.data &&\n      flowProof.data.nonce &&\n      flowProof.data.signatures &&\n      flowProof.data.signatures.length > 0 &&\n      flowProof.data.address &&\n      resolverCalled &&\n      encode(\n        JSON.stringify({\n          type: 'flow',\n          address: flowProof.data.address,\n          nonce: flowProof.data.nonce,\n          signatures: flowProof.data.signatures,\n        })\n      )) ||\n    null;\n\n  // Subscribe to changes\n  const addListeners = async (web3ModalProvider: any) => {\n    // Subscribe to accounts change\n    web3ModalProvider.on('accountsChanged', () => {\n      window.location.reload();\n    });\n\n    // Subscribe to provider disconnection\n    web3ModalProvider.on('disconnect', async () => {\n      await web3Modal.clearCachedProvider();\n      disconnect();\n    });\n\n    // Subscribe to chainId change\n    web3ModalProvider.on('chainChanged', (chainId: string) => {\n      setChain(`eip155:${parseInt(chainId, 16)}`);\n    });\n  };\n\n  // Connect MetaMask wallet\n  const connect = async () => {\n    const provider = await web3Modal.connect();\n    addListeners(provider);\n    const ethersProvider = new ethersLib.providers.Web3Provider(provider);\n    const userAddress = await ethersProvider.getSigner().getAddress();\n    const userChain = await ethersProvider.getSigner().getChainId();\n    const accounts = await ethersProvider.listAccounts();\n    setLibrary(ethersProvider);\n    if (accounts) setAccount(accounts[0]);\n    setAddress(userAddress);\n    // For EVM wallet always set Ethereum chain\n    setChain(`eip155:${userChain}`);\n  };\n\n  // Connect with Flow wallet\n  const connectFlow = () => {\n    fcl.authenticate();\n  };\n\n  // Clear user state\n  const clearUserState = () => {\n    setUser(null);\n    setAddress(null);\n    setChain(null);\n    setAccount(null);\n    setMessage(null);\n    setToken(null);\n    setSignature(null);\n    setFlowUser({ addr: '' });\n  };\n\n  // Disconnect user\n  const disconnect = async () => {\n    await web3Modal.clearCachedProvider();\n    if (flowUser && flowUser.addr) {\n      fcl.unauthenticate();\n    }\n    clearUserState();\n    clearAuthSession();\n  };\n\n  // Fetch authentication message or access token from the engine API\n  const startSession = async (userAddress: string) => {\n    // Try to fetch access token\n    const resWithCreds = await fetch(\n      `${ENGINE_URL}/oauth/session?address=${userAddress}`,\n      {\n        method: 'GET',\n        credentials: 'include',\n      }\n    );\n    if (resWithCreds && resWithCreds.ok) {\n      let json = await resWithCreds.json();\n\n      // Set access token if exists\n      if (json.access_token) {\n        setToken(json);\n      } else if (json.message) {\n        // Or set auth message\n        setMessage(json.message);\n      }\n    } else {\n      console.error(\n        'startSessionWithCreds error',\n        (resWithCreds && resWithCreds.status) || 'Unknown error'\n      );\n    }\n  };\n\n  // Sign authentication message with MetaMask\n  const signMessage = async (lib: any, msg: string, userAccount: string) => {\n    if (!web3Modal) return;\n    try {\n      const newSignature = await lib.provider.request({\n        method: 'personal_sign',\n        params: [msg, userAccount],\n      });\n      setSignature(newSignature);\n    } catch (error) {\n      console.error('signMessage error', error);\n      clearUserState();\n    }\n  };\n\n  // Get access token from the engine API\n  const getToken = async (code: string) => {\n    const res = await fetch(`${ENGINE_URL}/oauth/token`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        grant_type: 'authorization_code',\n        code: code,\n      }),\n    });\n\n    if (res.ok) {\n      let result = await res.json();\n      // Set address and chain if Flow user proofed\n      if (flowProof) {\n        setAddress((flowUser && flowUser.addr) || null);\n        setChain('flow:mainnet');\n      }\n      setToken(result);\n    } else {\n      console.error('getToken error', res.status);\n      // handle expried nonce for Flow user\n      if (flowProof) {\n        try {\n          await disconnect();\n        } catch (err) {\n          //\n        }\n        fcl.authenticate();\n      } else {\n        clearUserState();\n        disconnect();\n      }\n    }\n  };\n\n  // Set refresh_token cookie\n  const registerAuthSession = async (refresh_token: string) => {\n    const res = await fetch(`${ENGINE_URL}/oauth/session-register`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        refresh_token: refresh_token,\n      }),\n    });\n\n    if (!res.ok) {\n      console.error('registerAuthSession error', res.status);\n    }\n  };\n\n  // Remove refresh_token cookie\n  const clearAuthSession = async () => {\n    const res = await fetch(`${ENGINE_URL}/oauth/session-register`, {\n      method: 'POST',\n      credentials: 'include',\n    });\n\n    if (!res.ok) {\n      console.error('clearAuthSession error', res.status);\n    }\n  };\n\n  // Flow auth account proof data resolver\n  const accountProofDataResolver: AccountProofDataResolver = async () => {\n    setResolverCalled(true);\n\n    const res = await fetch(`${ENGINE_URL}/oauth/flow/session`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n\n    if (res && res.ok) {\n      let json = await res.json();\n\n      // Return nonce on success\n      if (json.nonce) {\n        return {\n          appIdentifier: 'Grindery Nexus',\n          nonce: json.nonce,\n        };\n      } else {\n        throw new Error('get nonce failed');\n      }\n    } else {\n      console.error(\n        'getFlowNonce error',\n        (res && res.status) || 'Unknown error'\n      );\n      throw new Error('get nonce failed');\n    }\n  };\n\n  const restoreFlowSession = async (address: string) => {\n    const res = await fetch(\n      `${ENGINE_URL}/oauth/flow/session?address=${address}`,\n      {\n        method: 'GET',\n        credentials: 'include',\n      }\n    );\n\n    if (res && res.ok) {\n      let json = await res.json();\n\n      // Return nonce on success\n      if (json.access_token) {\n        setToken(json);\n        setAddress(address);\n        setChain('flow:mainnet');\n      } else {\n        throw new Error('flow user session failed');\n      }\n    } else {\n      console.error(\n        'flow user session failed',\n        (res && res.status) || 'Unknown error'\n      );\n      throw new Error('flow user session failed');\n    }\n  };\n\n  const getChains = () => {\n    fetch('https://cds.grindery.org/chains/evm.json')\n      .then(response => response.json())\n      .then(data => {\n        setChains(data);\n      });\n  };\n\n  useEffect(() => {\n    fcl.config().put('fcl.accountProof.resolver', accountProofDataResolver);\n  }, []);\n\n  // Set web3Modal instance\n  useEffect(() => {\n    const providerOptions = {};\n    const newWeb3Modal = new Web3Modal({\n      cacheProvider: cacheProvider,\n      network: 'mainnet',\n      providerOptions,\n    });\n    setWeb3Modal(newWeb3Modal);\n  }, []);\n\n  // connect automatically and without a popup if user was connected before\n  useEffect(() => {\n    if (web3Modal && web3Modal.cachedProvider) {\n      connect();\n    }\n  }, [web3Modal]);\n\n  // set user if token and address is known\n  useEffect(() => {\n    if (address && token && token.access_token) {\n      setUser(`eip155:1:${address}`);\n      if (token.refresh_token) {\n        registerAuthSession(token.refresh_token);\n      }\n    } else {\n      setUser(null);\n    }\n  }, [token, address]);\n\n  // Start session if user address is known\n  useEffect(() => {\n    if (address && !message && !signature && !token) {\n      startSession(address);\n    }\n  }, [address, message, signature, token]);\n\n  // Sign authentication message if message is known\n  useEffect(() => {\n    if (library && message && account && !signature && !token) {\n      signMessage(library, message, account);\n    }\n  }, [library, message, account, signature, token]);\n\n  // Get authentication token if message is signed\n  useEffect(() => {\n    if (code && !token) {\n      getToken(code);\n    }\n  }, [code, token]);\n\n  // subscribe to flow user update\n  useEffect(() => {\n    fcl.currentUser.subscribe(setFlowUser);\n  }, []);\n\n  // Restore Flow user session if user available without resolver\n  useEffect(() => {\n    if (flowUser && flowUser.addr && !resolverCalled) {\n      restoreFlowSession(flowUser.addr);\n    }\n  }, [flowUser, resolverCalled]);\n\n  useEffect(() => {\n    getChains();\n  }, []);\n\n  useEffect(() => {\n    window.nexus_auth = {\n      user,\n      address,\n      chain,\n      chainName,\n      message,\n      token,\n      flowUser,\n    };\n  }, [user, address, chain, message, token, flowUser, chainName]);\n\n  return (\n    <GrinderyNexusContext.Provider\n      value={{\n        user,\n        address,\n        chain,\n        token,\n        code,\n        flowUser,\n        provider,\n        ethers,\n        chainName,\n        connect,\n        disconnect,\n        setUser,\n        setAddress,\n        setChain,\n        connectFlow,\n      }}\n    >\n      {children}\n    </GrinderyNexusContext.Provider>\n  );\n};\n\n/** Grindery Nexus Hook */\nexport const useGrinderyNexus = () => useContext(GrinderyNexusContext);\n\nexport default GrinderyNexusContextProvider;\n"],"names":["ENGINE_URL","fcl","flow.network","discovery.wallet","app.detail.title","app.detail.icon","GrinderyNexusContext","createContext","user","address","chain","token","code","flowUser","addr","provider","ethers","chainName","connect","disconnect","setUser","setAddress","setChain","connectFlow","GrinderyNexusContextProvider","props","children","cacheProvider","useState","web3Modal","setWeb3Modal","library","setLibrary","account","setAccount","message","setMessage","setToken","signature","setSignature","setFlowUser","resolverCalled","setResolverCalled","setChains","find","c","value","label","ethersLib","flowProof","services","_flowUser$services","service","type","encode","JSON","stringify","data","nonce","signatures","length","addListeners","web3ModalProvider","on","window","location","reload","_context","clearCachedProvider","chainId","parseInt","_context3","ethersProvider","Web3Provider","getSigner","getAddress","userAddress","getChainId","userChain","listAccounts","accounts","clearUserState","_context4","clearAuthSession","startSession","_context5","fetch","method","credentials","resWithCreds","ok","json","access_token","console","error","status","signMessage","lib","msg","userAccount","_context6","request","params","getToken","_context7","headers","Content-Type","body","grant_type","res","result","registerAuthSession","refresh_token","_context8","_context9","accountProofDataResolver","_context10","appIdentifier","Error","restoreFlowSession","_context11","useEffect","put","newWeb3Modal","Web3Modal","network","providerOptions","cachedProvider","subscribe","then","response","nexus_auth","React","Provider","useContext"],"mappings":"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"}